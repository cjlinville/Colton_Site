<div id="map" style="width:100%;height:500px;border-radius:12px;"></div>

<link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet">
<script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>

<script>
(function () {
  function initMap() {
    var el = document.getElementById('map');
    if (!el) return;
    if (el.dataset.inited) { if (window._mlmap) window._mlmap.resize(); return; }
    el.dataset.inited = '1';

    var style = {
      "version": 8,
      "sources": {
        "osm": {
          "type": "raster",
          "tiles": ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
          "tileSize": 256,
          "attribution": "Â© OpenStreetMap contributors"
        }
      },
      "layers": [{ "id": "osm", "type": "raster", "source": "osm" }]
    };

    var map = new maplibregl.Map({
      container: "map",
      style: style,
      center: [-111.8910, 40.7608], // lon, lat
      zoom: 9
    });
    window._mlmap = map;
    map.addControl(new maplibregl.NavigationControl(), "top-right");
    map.on("load", function () { setTimeout(function(){ map.resize(); }, 0); });
  }

  // initial full load
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initMap);
  } else {
    initMap();
  }
  // re-run after Hydejack PJAX navigations
  document.addEventListener("pjax:load", function () {
    initMap();
    if (window._mlmap) setTimeout(function(){ window._mlmap.resize(); }, 0);
  });
})();
</script>
